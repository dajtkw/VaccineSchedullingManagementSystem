@model IEnumerable<QuanLyTiemChung.Web.Models.Vaccine>
@{
    ViewData["Title"] = "Quản Lý Vắc-xin";
}

<style>
    /* Thêm một chút CSS để hiệu ứng hover trên card đẹp hơn */
    .vaccine-card {
        transition: transform .2s ease-in-out, box-shadow .2s ease-in-out;
    }

    .vaccine-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h1>@ViewData["Title"]</h1>
        <p class="text-muted">Xem, tìm kiếm và quản lý tất cả các loại vắc-xin trong hệ thống.</p>
    </div>
    <div>
        <a asp-action="ManageCategories" class="btn btn-outline-secondary">
            <i class="fas fa-tags me-2"></i>Quản Lý Danh Mục
        </a>
        <a asp-action="CreateVaccine" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Thêm Vắc-xin Mới
        </a>
    </div>
</div>

<partial name="_StatusMessage" />

<!-- Thanh tìm kiếm -->
<div class="mb-4">
    <div class="input-group">
        <span class="input-group-text"><i class="fas fa-search"></i></span>
        <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm theo tên thương mại hoặc tên chung...">
    </div>
</div>

<!-- Danh sách vắc-xin dạng thẻ -->
<div class="row" id="vaccine-list">
    @if (!Model.Any())
    {
        <div class="col-12">
            <div class="alert alert-info">
                Chưa có dữ liệu vắc-xin nào. Hãy bắt đầu bằng cách <a asp-action="CreateVaccine">thêm một vắc-xin mới</a>.
            </div>
        </div>
    }

    @foreach (var item in Model)
    {
        <div class="col-md-6 col-lg-4 mb-4 vaccine-item">
            <div class="card h-100 shadow-sm vaccine-card">
                <div class="card-body d-flex flex-column">
                    <div class="mb-2">
                        <span class="badge bg-primary">@(item.VaccineCategory?.Name ?? "Chưa phân loại")</span>
                    </div>
                    <h5 class="card-title trade-name">@item.TradeName</h5>
                    <p class="card-subtitle mb-2 text-muted generic-name">@item.GenericName</p>
                    <p class="card-text small flex-grow-1">
                        @(!string.IsNullOrEmpty(item.Description) ? item.Description : "Chưa có mô tả chi tiết.")
                    </p>
                    
                    <div class="mt-3">
                        <span class="badge rounded-pill bg-secondary me-2">@item.Doses.Count() liều</span>
                        <span class="text-muted small">Nhà sản xuất: @(item.Manufacturer ?? "N/A")</span>
                    </div>
                </div>
                <div class="card-footer bg-light border-0 text-end">
                    <a asp-action="VaccineDetails" asp-route-id="@item.Id" class="btn btn-sm btn-outline-info">
                        <i class="fas fa-info-circle me-1"></i> Chi tiết
                    </a>
                    <a asp-action="EditVaccine" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-edit me-1"></i> Sửa
                    </a>
                    <a asp-action="DeleteVaccine" asp-route-id="@item.Id" class="btn btn-sm btn-outline-danger">
                        <i class="fas fa-trash-alt me-1"></i> Xóa
                    </a>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function(){
            $("#searchInput").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#vaccine-list .vaccine-item").filter(function() {
                    var tradeName = $(this).find(".trade-name").text().toLowerCase();
                    var genericName = $(this).find(".generic-name").text().toLowerCase();
                    $(this).toggle(tradeName.indexOf(value) > -1 || genericName.indexOf(value) > -1)
                });
            });
        });
    </script>
}
