@model QuanLyTiemChung.Web.ViewModels.AdminDashboardViewModel

@* Ph·∫ßn th·ªëng k√™ tƒ©nh *@
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Ng∆∞·ªùi D√πng</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.TotalUsers</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-users fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @* Th√™m c√°c th·∫ª th·ªëng k√™ kh√°c n·∫øu b·∫°n mu·ªën *@
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Truy c·∫≠p nhanh</h6>
            </div>
            <div class="card-body">
                @* üî• B·∫ÆT ƒê·∫¶U PH·∫¶N TRUY C·∫¨P NHANH ƒê√É ƒê∆Ø·ª¢C KH√îI PH·ª§C *@
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <a href="#" class="btn btn-outline-primary d-block" onclick="loadContent('users')">
                            <i class="fas fa-users me-2"></i>Qu·∫£n L√Ω Ng∆∞·ªùi D√πng
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a href="#" class="btn btn-outline-success d-block" onclick="loadContent('appointments')">
                            <i class="fas fa-calendar-check me-2"></i>Qu·∫£n L√Ω L·ªãch H·∫πn
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a href="#" class="btn btn-outline-info d-block" onclick="loadContent('vaccines')">
                            <i class="fas fa-syringe me-2"></i>Qu·∫£n L√Ω V·∫Øc-xin
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a href="#" class="btn btn-outline-warning d-block" onclick="loadContent('sites')">
                            <i class="fas fa-map-marker-alt me-2"></i>Qu·∫£n L√Ω ƒêi·ªÉm Ti√™m
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a href="#" class="btn btn-outline-dark d-block" onclick="loadContent('inventory')">
                            <i class="fas fa-boxes me-2"></i>Qu·∫£n L√Ω T·ªìn Kho
                        </a>
                    </div>
                     <div class="col-md-6 mb-3">
                        <a href="#" class="btn btn-outline-secondary d-block" onclick="loadContent('reports')">
                            <i class="fas fa-chart-line me-2"></i>Th·ªëng k√™ & B√°o c√°o
                        </a>
                    </div>
                </div>
                @* üî• K·∫æT TH√öC PH·∫¶N TRUY C·∫¨P NHANH *@
            </div>
        </div>
    </div>
</div>


@* PH·∫¶N TH·ªêNG K√ä TH·ªúI GIAN TH·ª∞C (GI·ªÆ NGUY√äN) *@
<h4 class="mb-3">Tr·∫°ng Th√°i H·ªá Th·ªëng (Th·ªùi gian th·ª±c)</h4>
<div class="row">
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-microchip me-2 text-info"></i>T·∫£i CPU</h5>
                <div class="progress" style="height: 25px;">
                    <div id="cpu-progress" class="progress-bar bg-info progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-memory me-2 text-warning"></i>S·ª≠ d·ª•ng RAM</h5>
                <div class="progress" style="height: 25px;">
                    <div id="ram-progress" class="progress-bar bg-warning progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-users me-2 text-success"></i>Ng∆∞·ªùi d√πng Online</h5>
                <p class="display-6 fw-bold text-success" id="online-users">0</p>
            </div>
        </div>
    </div>
</div>

@* Script n√†y ph·∫£i l√† m·ªôt ph·∫ßn c·ªßa partial view v√¨ n√≥ ƒë∆∞·ª£c t·∫£i ƒë·ªông *@
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.0/signalr.min.js"></script>
<script>
    if (typeof dashboardConnection === 'undefined' || dashboardConnection.state === 'Disconnected') {
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/dashboardHub")
            .configureLogging(signalR.LogLevel.Information)
            .build();

        window.dashboardConnection = connection;

        connection.on("ReceiveSystemStatus", (status) => {
            const cpuProgress = $('#cpu-progress');
            if (cpuProgress.length) {
                cpuProgress.css('width', status.cpuLoad + '%').text(status.cpuLoad + '%').attr('aria-valuenow', status.cpuLoad);
            }

            const ramProgress = $('#ram-progress');
            if (ramProgress.length) {
                ramProgress.css('width', status.memoryUsage + '%').text(status.memoryUsage + '%').attr('aria-valuenow', status.memoryUsage);
            }

            const onlineUsers = $('#online-users');
            if (onlineUsers.length) {
                onlineUsers.text(status.onlineUsers);
            }
        });

        async function start() {
            try {
                await connection.start();
                console.log("SignalR Connected to DashboardHub.");
            } catch (err) {
                console.error("SignalR DashboardHub Connection Error: ", err);
                setTimeout(start, 5000);
            }
        };

        connection.onclose(async () => {
            await start();
        });

        start();
    }
</script>
